<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Material Operacional - Corpo de Bombeiros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-disponivel { background-color: #10b981; }
        .status-manutencao { background-color: #f59e0b; }
        .status-indisponivel { background-color: #ef4444; }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <div class="min-h-full">
        <!-- Header -->
        <header class="bg-red-600 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <div class="text-2xl font-bold">üöí</div>
                        <h1 class="ml-3 text-xl font-semibold">Controle de Material Operacional</h1>
                    </div>
                    <div class="text-sm">
                        <span id="currentDate"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-red-700 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showSection('dashboard')" class="nav-btn py-3 px-4 text-sm font-medium hover:bg-red-800 transition-colors border-b-2 border-transparent hover:border-white" id="nav-dashboard">
                        üìä Dashboard
                    </button>
                    <button onclick="showSection('equipamentos')" class="nav-btn py-3 px-4 text-sm font-medium hover:bg-red-800 transition-colors border-b-2 border-transparent hover:border-white" id="nav-equipamentos">
                        üõ†Ô∏è Equipamentos
                    </button>
                    <button onclick="showSection('viaturas')" class="nav-btn py-3 px-4 text-sm font-medium hover:bg-red-800 transition-colors border-b-2 border-transparent hover:border-white" id="nav-viaturas">
                        üöõ Viaturas
                    </button>
                    <button onclick="showSection('manutencao')" class="nav-btn py-3 px-4 text-sm font-medium hover:bg-red-800 transition-colors border-b-2 border-transparent hover:border-white" id="nav-manutencao">
                        üîß Manuten√ß√£o
                    </button>
                    <button onclick="showSection('prestacao')" class="nav-btn py-3 px-4 text-sm font-medium hover:bg-red-800 transition-colors border-b-2 border-transparent hover:border-white" id="nav-prestacao">
                        üì± Presta√ß√£o de Contas
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section fade-in">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Dashboard Operacional</h2>
                    
                    <!-- Status Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-green-100 rounded-lg">
                                    <div class="w-6 h-6 text-green-600">‚úÖ</div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Equipamentos Dispon√≠veis</p>
                                    <p class="text-2xl font-semibold text-gray-900" id="equipamentos-disponiveis">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-lg">
                                    <div class="w-6 h-6 text-yellow-600">‚ö†Ô∏è</div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Em Manuten√ß√£o</p>
                                    <p class="text-2xl font-semibold text-gray-900" id="equipamentos-manutencao">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <div class="w-6 h-6 text-blue-600">üöõ</div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Viaturas Ativas</p>
                                    <p class="text-2xl font-semibold text-gray-900" id="viaturas-ativas">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-red-100 rounded-lg">
                                    <div class="w-6 h-6 text-red-600">üî¥</div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Itens Cr√≠ticos</p>
                                    <p class="text-2xl font-semibold text-gray-900" id="itens-criticos">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Atividades Recentes</h3>
                        </div>
                        <div class="p-6">
                            <div id="recent-activities" class="space-y-3">
                                <!-- Activities will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipamentos Section -->
            <div id="equipamentos-section" class="section hidden">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-900">Gest√£o de Equipamentos</h2>
                        <button onclick="showAddEquipamentoModal()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            ‚ûï Adicionar Equipamento
                        </button>
                    </div>
                    
                    <!-- Filters -->
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="filter-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="filter-categoria" onchange="filterEquipamentos()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="">Todas as categorias</option>
                                    <option value="Combate">Combate a Inc√™ndio</option>
                                    <option value="Resgate">Resgate</option>
                                    <option value="EPI">EPI</option>
                                    <option value="Comunicacao">Comunica√ß√£o</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="filter-status" onchange="filterEquipamentos()" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="">Todos os status</option>
                                    <option value="Dispon√≠vel">Dispon√≠vel</option>
                                    <option value="Em Manuten√ß√£o">Em Manuten√ß√£o</option>
                                    <option value="Indispon√≠vel">Indispon√≠vel</option>
                                </select>
                            </div>
                            <div>
                                <label for="search-equipamento" class="block text-sm font-medium text-gray-700 mb-1">Buscar</label>
                                <input type="text" id="search-equipamento" onkeyup="filterEquipamentos()" placeholder="Nome ou c√≥digo..." class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                            </div>
                        </div>
                    </div>

                    <!-- Equipment List -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">C√≥digo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">QR Code</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">√öltima Manuten√ß√£o</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="equipamentos-table" class="bg-white divide-y divide-gray-200">
                                <!-- Equipment rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Viaturas Section -->
            <div id="viaturas-section" class="section hidden">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-900">Gest√£o de Viaturas</h2>
                        <button onclick="showAddViaturaModal()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            ‚ûï Adicionar Viatura
                        </button>
                    </div>
                    
                    <!-- Viaturas Grid -->
                    <div id="viaturas-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Viatura cards will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Manuten√ß√£o Section -->
            <div id="manutencao-section" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Controle de Manuten√ß√£o</h2>
                    
                    <!-- Maintenance Calendar -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Manuten√ß√µes Programadas</h3>
                            <div id="manutencoes-programadas" class="space-y-3">
                                <!-- Scheduled maintenance will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Hist√≥rico de Manuten√ß√µes</h3>
                            <div id="historico-manutencoes" class="space-y-3">
                                <!-- Maintenance history will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Presta√ß√£o de Contas Section -->
            <div id="prestacao-section" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Presta√ß√£o de Contas - Cat√°logo de Materiais</h2>
                    
                    <!-- Cat√°logo de Materiais -->
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Cat√°logo de Materiais para Verifica√ß√£o</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-600">
                                    Total: <span id="catalogo-total">0</span> | 
                                    Verificados: <span id="catalogo-verificados" class="text-green-600 font-semibold">0</span> | 
                                    Pendentes: <span id="catalogo-pendentes" class="text-red-600 font-semibold">0</span>
                                </span>
                                <button onclick="resetCatalogo()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    üîÑ Resetar
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="catalogo-materiais">
                                <!-- Cat√°logo ser√° preenchido pelo JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- QR Code Scanner -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Scanner QR Code - Verifica√ß√£o</h3>
                            
                            <div class="space-y-4">
                                <div class="flex space-x-3">
                                    <button onclick="startQRScanner()" id="start-scanner-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        üì∑ Iniciar Scanner
                                    </button>
                                    <button onclick="stopQRScanner()" id="stop-scanner-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors hidden">
                                        ‚èπÔ∏è Parar Scanner
                                    </button>
                                </div>
                                
                                <!-- Camera Preview -->
                                <div id="qr-scanner-container" class="hidden">
                                    <div class="relative bg-gray-900 rounded-lg overflow-hidden" style="height: 300px;">
                                        <video id="qr-video" class="w-full h-full object-cover" autoplay muted playsinline></video>
                                        <div class="absolute inset-0 border-2 border-red-500 rounded-lg pointer-events-none">
                                            <div class="absolute top-4 left-4 w-8 h-8 border-t-4 border-l-4 border-red-500"></div>
                                            <div class="absolute top-4 right-4 w-8 h-8 border-t-4 border-r-4 border-red-500"></div>
                                            <div class="absolute bottom-4 left-4 w-8 h-8 border-b-4 border-l-4 border-red-500"></div>
                                            <div class="absolute bottom-4 right-4 w-8 h-8 border-b-4 border-r-4 border-red-500"></div>
                                        </div>
                                        <div class="absolute bottom-2 left-2 right-2 text-center">
                                            <p class="text-white text-sm bg-black bg-opacity-50 rounded px-2 py-1">
                                                Posicione o QR Code dentro da √°rea de leitura
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Manual Input -->
                                <div class="border-t pt-4">
                                    <label for="manual-qr-input" class="block text-sm font-medium text-gray-700 mb-2">
                                        Ou digite o c√≥digo manualmente:
                                    </label>
                                    <div class="flex space-x-2">
                                        <input type="text" id="manual-qr-input" placeholder="Digite o c√≥digo do equipamento..." class="flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                                        <button onclick="processManualCode()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Scan Result -->
                                <div id="scan-result" class="hidden p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <h4 class="font-medium text-green-800 mb-2">Equipamento Encontrado:</h4>
                                    <div id="scanned-equipment-info"></div>
                                </div>

                                <div id="scan-error" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p class="text-red-800">Equipamento n√£o encontrado ou c√≥digo inv√°lido.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Status da Verifica√ß√£o -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Status da Verifica√ß√£o</h3>
                            
                            <div id="verificacao-status" class="space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <div class="text-4xl mb-2">üìã</div>
                                    <p>Escaneie os QR Codes dos materiais para verificar</p>
                                    <p class="text-sm">O sistema marcar√° automaticamente como "OK" quando encontrado</p>
                                </div>
                            </div>

                            <!-- √öltimas Verifica√ß√µes -->
                            <div id="ultimas-verificacoes" class="mt-6 hidden">
                                <h4 class="text-sm font-medium text-gray-900 mb-3">√öltimas Verifica√ß√µes:</h4>
                                <div id="lista-verificacoes" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Verifica√ß√µes ser√£o adicionadas aqui -->
                                </div>
                            </div>

                            <!-- A√ß√µes do Cat√°logo -->
                            <div class="mt-6 pt-4 border-t border-gray-200">
                                <div class="flex space-x-3">
                                    <button onclick="gerarRelatorioCatalogo()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        üìä Gerar Relat√≥rio
                                    </button>
                                    <button onclick="finalizarVerificacao()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        ‚úÖ Finalizar Verifica√ß√£o
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hist√≥rico de Presta√ß√µes -->
                    <div class="mt-6 bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Hist√≥rico de Presta√ß√µes de Contas</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data/Hora</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Equipamento</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Respons√°vel</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√£o</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Observa√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="prestacoes-table" class="bg-white divide-y divide-gray-200">
                                    <!-- Presta√ß√µes will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Equipment Modal -->
        <div id="add-equipamento-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Adicionar Equipamento</h3>
                </div>
                <form id="add-equipamento-form" class="p-6 space-y-4">
                    <div>
                        <label for="equipamento-codigo" class="block text-sm font-medium text-gray-700 mb-1">C√≥digo</label>
                        <input type="text" id="equipamento-codigo" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="equipamento-nome" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                        <input type="text" id="equipamento-nome" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="equipamento-categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                        <select id="equipamento-categoria" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Selecione uma categoria</option>
                            <option value="Combate">Combate a Inc√™ndio</option>
                            <option value="Resgate">Resgate</option>
                            <option value="EPI">EPI</option>
                            <option value="Comunicacao">Comunica√ß√£o</option>
                        </select>
                    </div>
                    <div>
                        <label for="equipamento-descricao" class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                        <textarea id="equipamento-descricao" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideAddEquipamentoModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Viatura Modal -->
        <div id="add-viatura-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Adicionar Viatura</h3>
                </div>
                <form id="add-viatura-form" class="p-6 space-y-4">
                    <div>
                        <label for="viatura-prefixo" class="block text-sm font-medium text-gray-700 mb-1">Prefixo</label>
                        <input type="text" id="viatura-prefixo" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="viatura-tipo" class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                        <select id="viatura-tipo" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="">Selecione o tipo</option>
                            <option value="Auto Bomba">Auto Bomba</option>
                            <option value="Auto Escada">Auto Escada</option>
                            <option value="Auto Resgate">Auto Resgate</option>
                            <option value="Auto Tanque">Auto Tanque</option>
                            <option value="Ambul√¢ncia">Ambul√¢ncia</option>
                        </select>
                    </div>
                    <div>
                        <label for="viatura-placa" class="block text-sm font-medium text-gray-700 mb-1">Placa</label>
                        <input type="text" id="viatura-placa" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="viatura-ano" class="block text-sm font-medium text-gray-700 mb-1">Ano</label>
                        <input type="number" id="viatura-ano" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideAddViaturaModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let equipamentos = [
            {
                id: 1,
                codigo: 'EQ001',
                nome: 'Mangueira 2.5"',
                categoria: 'Combate',
                status: 'Dispon√≠vel',
                descricao: 'Mangueira de combate a inc√™ndio 2.5 polegadas',
                ultimaManutencao: '2024-01-15',
                qrCode: 'EQ001-MANG-2024'
            },
            {
                id: 2,
                codigo: 'EQ002',
                nome: 'Capacete F1',
                categoria: 'EPI',
                status: 'Dispon√≠vel',
                descricao: 'Capacete de prote√ß√£o individual F1',
                ultimaManutencao: '2024-01-10',
                qrCode: 'EQ002-CAP-2024'
            },
            {
                id: 3,
                codigo: 'EQ003',
                nome: 'Escada Magirus',
                categoria: 'Resgate',
                status: 'Em Manuten√ß√£o',
                descricao: 'Escada extens√≠vel Magirus 30m',
                ultimaManutencao: '2024-01-05',
                qrCode: 'EQ003-ESC-2024'
            },
            {
                id: 4,
                codigo: 'EQ004',
                nome: 'Extintor CO2 6kg',
                categoria: 'Combate',
                status: 'Dispon√≠vel',
                descricao: 'Extintor de CO2 6kg para classe C',
                ultimaManutencao: '2024-01-12',
                qrCode: 'EQ004-EXT-2024'
            },
            {
                id: 5,
                codigo: 'EQ005',
                nome: 'M√°scara Aut√¥noma',
                categoria: 'EPI',
                status: 'Dispon√≠vel',
                descricao: 'Equipamento de respira√ß√£o aut√¥noma',
                ultimaManutencao: '2024-01-08',
                qrCode: 'EQ005-MASK-2024'
            },
            {
                id: 6,
                codigo: 'EQ006',
                nome: 'R√°dio Port√°til',
                categoria: 'Comunicacao',
                status: 'Dispon√≠vel',
                descricao: 'R√°dio comunicador port√°til VHF',
                ultimaManutencao: '2024-01-18',
                qrCode: 'EQ006-RAD-2024'
            }
        ];

        // Cat√°logo de materiais para verifica√ß√£o
        let catalogoMateriais = [
            { id: 1, equipamentoId: 1, verificado: false, dataVerificacao: null, responsavel: null },
            { id: 2, equipamentoId: 2, verificado: false, dataVerificacao: null, responsavel: null },
            { id: 3, equipamentoId: 3, verificado: false, dataVerificacao: null, responsavel: null },
            { id: 4, equipamentoId: 4, verificado: false, dataVerificacao: null, responsavel: null },
            { id: 5, equipamentoId: 5, verificado: false, dataVerificacao: null, responsavel: null },
            { id: 6, equipamentoId: 6, verificado: false, dataVerificacao: null, responsavel: null }
        ];

        let prestacoes = [
            {
                id: 1,
                equipamentoId: 1,
                responsavel: 'Sgt. Silva',
                acao: 'Retirada',
                observacoes: 'Equipamento em perfeito estado',
                dataHora: '2024-01-20T08:30:00'
            },
            {
                id: 2,
                equipamentoId: 2,
                responsavel: 'Cb. Santos',
                acao: 'Devolucao',
                observacoes: 'Capacete limpo e verificado',
                dataHora: '2024-01-19T17:45:00'
            }
        ];

        // QR Scanner variables
        let qrStream = null;
        let qrScanning = false;

        let viaturas = [
            {
                id: 1,
                prefixo: 'AB-01',
                tipo: 'Auto Bomba',
                placa: 'ABC-1234',
                ano: 2020,
                status: 'Ativa',
                quilometragem: 45000
            },
            {
                id: 2,
                prefixo: 'AR-01',
                tipo: 'Auto Resgate',
                placa: 'DEF-5678',
                ano: 2019,
                status: 'Ativa',
                quilometragem: 52000
            }
        ];

        let manutencoes = [
            {
                id: 1,
                equipamentoId: 3,
                tipo: 'Preventiva',
                descricao: 'Revis√£o geral da escada',
                dataInicio: '2024-01-20',
                dataPrevisao: '2024-01-25',
                status: 'Em andamento'
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            showSection('dashboard');
            updateDashboard();
            renderEquipamentos();
            renderViaturas();
            renderManutencoes();
            renderPrestacoes();
            renderCatalogoMateriais();
        });

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-BR', options);
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Update navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('border-white', 'bg-red-800');
            });
            document.getElementById('nav-' + sectionName).classList.add('border-white', 'bg-red-800');
        }

        // Dashboard functions
        function updateDashboard() {
            const disponiveis = equipamentos.filter(eq => eq.status === 'Dispon√≠vel').length;
            const manutencao = equipamentos.filter(eq => eq.status === 'Em Manuten√ß√£o').length;
            const viaturasAtivas = viaturas.filter(v => v.status === 'Ativa').length;
            const criticos = equipamentos.filter(eq => eq.status === 'Indispon√≠vel').length;

            document.getElementById('equipamentos-disponiveis').textContent = disponiveis;
            document.getElementById('equipamentos-manutencao').textContent = manutencao;
            document.getElementById('viaturas-ativas').textContent = viaturasAtivas;
            document.getElementById('itens-criticos').textContent = criticos;

            // Update recent activities
            const activities = [
                { text: 'Equipamento EQ003 enviado para manuten√ß√£o', time: '2 horas atr√°s', type: 'warning' },
                { text: 'Nova viatura AR-02 adicionada ao sistema', time: '1 dia atr√°s', type: 'success' },
                { text: 'Manuten√ß√£o preventiva conclu√≠da - EQ001', time: '2 dias atr√°s', type: 'success' },
                { text: 'Inspe√ß√£o mensal realizada', time: '3 dias atr√°s', type: 'info' }
            ];

            const activitiesHtml = activities.map(activity => `
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 rounded-full ${activity.type === 'success' ? 'bg-green-400' : activity.type === 'warning' ? 'bg-yellow-400' : 'bg-blue-400'}"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900">${activity.text}</p>
                        <p class="text-xs text-gray-500">${activity.time}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('recent-activities').innerHTML = activitiesHtml;
        }

        // Equipment functions
        function renderEquipamentos() {
            const tbody = document.getElementById('equipamentos-table');
            tbody.innerHTML = equipamentos.map(eq => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${eq.codigo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${eq.nome}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${eq.categoria}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white ${getStatusClass(eq.status)}">
                            ${eq.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs font-mono bg-gray-100 px-2 py-1 rounded">${eq.qrCode}</span>
                            <button onclick="generateQRCode('${eq.qrCode}')" class="text-blue-600 hover:text-blue-900 text-xs">
                                üì± Ver QR
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(eq.ultimaManutencao)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editEquipamento(${eq.id})" class="text-red-600 hover:text-red-900 mr-3">Editar</button>
                        <button onclick="deleteEquipamento(${eq.id})" class="text-red-600 hover:text-red-900">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Dispon√≠vel': return 'status-disponivel';
                case 'Em Manuten√ß√£o': return 'status-manutencao';
                case 'Indispon√≠vel': return 'status-indisponivel';
                default: return 'bg-gray-500';
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function filterEquipamentos() {
            const categoria = document.getElementById('filter-categoria').value;
            const status = document.getElementById('filter-status').value;
            const search = document.getElementById('search-equipamento').value.toLowerCase();

            const filtered = equipamentos.filter(eq => {
                return (!categoria || eq.categoria === categoria) &&
                       (!status || eq.status === status) &&
                       (!search || eq.nome.toLowerCase().includes(search) || eq.codigo.toLowerCase().includes(search));
            });

            const tbody = document.getElementById('equipamentos-table');
            tbody.innerHTML = filtered.map(eq => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${eq.codigo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${eq.nome}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${eq.categoria}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white ${getStatusClass(eq.status)}">
                            ${eq.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs font-mono bg-gray-100 px-2 py-1 rounded">${eq.qrCode}</span>
                            <button onclick="generateQRCode('${eq.qrCode}')" class="text-blue-600 hover:text-blue-900 text-xs">
                                üì± Ver QR
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(eq.ultimaManutencao)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editEquipamento(${eq.id})" class="text-red-600 hover:text-red-900 mr-3">Editar</button>
                        <button onclick="deleteEquipamento(${eq.id})" class="text-red-600 hover:text-red-900">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Viatura functions
        function renderViaturas() {
            const grid = document.getElementById('viaturas-grid');
            grid.innerHTML = viaturas.map(viatura => `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">${viatura.prefixo}</h3>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white bg-green-500">
                            ${viatura.status}
                        </span>
                    </div>
                    <div class="space-y-2">
                        <p class="text-sm text-gray-600"><strong>Tipo:</strong> ${viatura.tipo}</p>
                        <p class="text-sm text-gray-600"><strong>Placa:</strong> ${viatura.placa}</p>
                        <p class="text-sm text-gray-600"><strong>Ano:</strong> ${viatura.ano}</p>
                        <p class="text-sm text-gray-600"><strong>Quilometragem:</strong> ${viatura.quilometragem.toLocaleString('pt-BR')} km</p>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button onclick="editViatura(${viatura.id})" class="flex-1 bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded transition-colors">
                            Editar
                        </button>
                        <button onclick="deleteViatura(${viatura.id})" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white text-sm py-2 px-3 rounded transition-colors">
                            Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Maintenance functions
        function renderManutencoes() {
            const programadas = document.getElementById('manutencoes-programadas');
            const historico = document.getElementById('historico-manutencoes');

            const programadasHtml = manutencoes.filter(m => m.status === 'Em andamento').map(m => {
                const equipamento = equipamentos.find(eq => eq.id === m.equipamentoId);
                return `
                    <div class="border-l-4 border-yellow-400 pl-4 py-2">
                        <p class="text-sm font-medium text-gray-900">${equipamento ? equipamento.nome : 'Equipamento n√£o encontrado'}</p>
                        <p class="text-xs text-gray-500">${m.descricao}</p>
                        <p class="text-xs text-gray-500">Previs√£o: ${formatDate(m.dataPrevisao)}</p>
                    </div>
                `;
            }).join('');

            const historicoHtml = `
                <div class="border-l-4 border-green-400 pl-4 py-2">
                    <p class="text-sm font-medium text-gray-900">Mangueira 2.5"</p>
                    <p class="text-xs text-gray-500">Manuten√ß√£o preventiva conclu√≠da</p>
                    <p class="text-xs text-gray-500">Conclu√≠da em: 15/01/2024</p>
                </div>
                <div class="border-l-4 border-green-400 pl-4 py-2">
                    <p class="text-sm font-medium text-gray-900">Capacete F1</p>
                    <p class="text-xs text-gray-500">Inspe√ß√£o de seguran√ßa</p>
                    <p class="text-xs text-gray-500">Conclu√≠da em: 10/01/2024</p>
                </div>
            `;

            programadas.innerHTML = programadasHtml || '<p class="text-sm text-gray-500">Nenhuma manuten√ß√£o programada</p>';
            historico.innerHTML = historicoHtml;
        }

        // Modal functions
        function showAddEquipamentoModal() {
            document.getElementById('add-equipamento-modal').classList.remove('hidden');
            document.getElementById('add-equipamento-modal').classList.add('flex');
        }

        function hideAddEquipamentoModal() {
            document.getElementById('add-equipamento-modal').classList.add('hidden');
            document.getElementById('add-equipamento-modal').classList.remove('flex');
            document.getElementById('add-equipamento-form').reset();
        }

        function showAddViaturaModal() {
            document.getElementById('add-viatura-modal').classList.remove('hidden');
            document.getElementById('add-viatura-modal').classList.add('flex');
        }

        function hideAddViaturaModal() {
            document.getElementById('add-viatura-modal').classList.add('hidden');
            document.getElementById('add-viatura-modal').classList.remove('flex');
            document.getElementById('add-viatura-form').reset();
        }

        // Form handlers
        document.getElementById('add-equipamento-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newEquipamento = {
                id: equipamentos.length + 1,
                codigo: document.getElementById('equipamento-codigo').value,
                nome: document.getElementById('equipamento-nome').value,
                categoria: document.getElementById('equipamento-categoria').value,
                status: 'Dispon√≠vel',
                descricao: document.getElementById('equipamento-descricao').value,
                ultimaManutencao: new Date().toISOString().split('T')[0],
                qrCode: document.getElementById('equipamento-codigo').value + '-' + new Date().getFullYear()
            };

            equipamentos.push(newEquipamento);
            renderEquipamentos();
            updateDashboard();
            hideAddEquipamentoModal();
        });

        document.getElementById('add-viatura-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newViatura = {
                id: viaturas.length + 1,
                prefixo: document.getElementById('viatura-prefixo').value,
                tipo: document.getElementById('viatura-tipo').value,
                placa: document.getElementById('viatura-placa').value,
                ano: parseInt(document.getElementById('viatura-ano').value),
                status: 'Ativa',
                quilometragem: 0
            };

            viaturas.push(newViatura);
            renderViaturas();
            updateDashboard();
            hideAddViaturaModal();
        });

        // CRUD functions
        function editEquipamento(id) {
            const equipamento = equipamentos.find(eq => eq.id === id);
            if (equipamento) {
                // In a real application, this would open an edit modal
                const newStatus = prompt('Novo status (Dispon√≠vel, Em Manuten√ß√£o, Indispon√≠vel):', equipamento.status);
                if (newStatus && ['Dispon√≠vel', 'Em Manuten√ß√£o', 'Indispon√≠vel'].includes(newStatus)) {
                    equipamento.status = newStatus;
                    renderEquipamentos();
                    updateDashboard();
                }
            }
        }

        function deleteEquipamento(id) {
            const index = equipamentos.findIndex(eq => eq.id === id);
            if (index > -1) {
                equipamentos.splice(index, 1);
                renderEquipamentos();
                updateDashboard();
            }
        }

        function editViatura(id) {
            const viatura = viaturas.find(v => v.id === id);
            if (viatura) {
                const newKm = prompt('Nova quilometragem:', viatura.quilometragem);
                if (newKm && !isNaN(newKm)) {
                    viatura.quilometragem = parseInt(newKm);
                    renderViaturas();
                }
            }
        }

        function deleteViatura(id) {
            const index = viaturas.findIndex(v => v.id === id);
            if (index > -1) {
                viaturas.splice(index, 1);
                renderViaturas();
                updateDashboard();
            }
        }

        // QR Code Functions
        function generateQRCode(qrData) {
            // Create QR Code using a simple text-based representation
            const qrModal = document.createElement('div');
            qrModal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            qrModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-sm w-full mx-4 p-6">
                    <div class="text-center">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">QR Code do Equipamento</h3>
                        <div class="bg-white border-2 border-gray-300 p-4 rounded-lg mb-4">
                            <div class="w-48 h-48 mx-auto bg-black relative" style="background-image: url('data:image/svg+xml;base64,${btoa(createQRCodeSVG(qrData))}'); background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">C√≥digo: <span class="font-mono font-bold">${qrData}</span></p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(qrModal);
        }

        function createQRCodeSVG(data) {
            // Simple QR code-like pattern generator
            const size = 200;
            const modules = 25;
            const moduleSize = size / modules;
            
            let svg = `<svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">`;
            svg += `<rect width="${size}" height="${size}" fill="white"/>`;
            
            // Create a pattern based on the data
            const hash = data.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            
            for (let i = 0; i < modules; i++) {
                for (let j = 0; j < modules; j++) {
                    const shouldFill = (hash + i * j + i + j) % 3 === 0;
                    if (shouldFill) {
                        svg += `<rect x="${i * moduleSize}" y="${j * moduleSize}" width="${moduleSize}" height="${moduleSize}" fill="black"/>`;
                    }
                }
            }
            
            // Add corner markers
            const cornerSize = moduleSize * 3;
            svg += `<rect x="0" y="0" width="${cornerSize}" height="${cornerSize}" fill="black"/>`;
            svg += `<rect x="${moduleSize}" y="${moduleSize}" width="${moduleSize}" height="${moduleSize}" fill="white"/>`;
            
            svg += `<rect x="${size - cornerSize}" y="0" width="${cornerSize}" height="${cornerSize}" fill="black"/>`;
            svg += `<rect x="${size - cornerSize + moduleSize}" y="${moduleSize}" width="${moduleSize}" height="${moduleSize}" fill="white"/>`;
            
            svg += `<rect x="0" y="${size - cornerSize}" width="${cornerSize}" height="${cornerSize}" fill="black"/>`;
            svg += `<rect x="${moduleSize}" y="${size - cornerSize + moduleSize}" width="${moduleSize}" height="${moduleSize}" fill="white"/>`;
            
            svg += '</svg>';
            return svg;
        }

        // QR Scanner Functions
        function startQRScanner() {
            const video = document.getElementById('qr-video');
            const container = document.getElementById('qr-scanner-container');
            const startBtn = document.getElementById('start-scanner-btn');
            const stopBtn = document.getElementById('stop-scanner-btn');

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 640 },
                    height: { ideal: 480 }
                } 
            })
            .then(stream => {
                qrStream = stream;
                video.srcObject = stream;
                container.classList.remove('hidden');
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                qrScanning = true;
                
                // Simulate QR code detection
                simulateQRDetection();
            })
            .catch(err => {
                console.error('Erro ao acessar a c√¢mera:', err);
                showScanError('N√£o foi poss√≠vel acessar a c√¢mera. Verifique as permiss√µes.');
            });
        }

        function stopQRScanner() {
            if (qrStream) {
                qrStream.getTracks().forEach(track => track.stop());
                qrStream = null;
            }
            
            const container = document.getElementById('qr-scanner-container');
            const startBtn = document.getElementById('start-scanner-btn');
            const stopBtn = document.getElementById('stop-scanner-btn');
            
            container.classList.add('hidden');
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            qrScanning = false;
            
            hideScanResults();
        }

        function simulateQRDetection() {
            // Simulate QR code detection after 3 seconds for demo purposes
            setTimeout(() => {
                if (qrScanning) {
                    const sampleCodes = ['EQ001-MANG-2024', 'EQ002-CAP-2024', 'EQ003-ESC-2024'];
                    const randomCode = sampleCodes[Math.floor(Math.random() * sampleCodes.length)];
                    processQRCode(randomCode);
                }
            }, 3000);
        }

        function processQRCode(qrData) {
            const equipamento = equipamentos.find(eq => eq.qrCode === qrData);
            
            if (equipamento) {
                // Verificar se o material est√° no cat√°logo
                const itemCatalogo = catalogoMateriais.find(item => item.equipamentoId === equipamento.id);
                
                if (itemCatalogo) {
                    if (!itemCatalogo.verificado) {
                        // Marcar como verificado
                        itemCatalogo.verificado = true;
                        itemCatalogo.dataVerificacao = new Date().toISOString();
                        itemCatalogo.responsavel = 'Sistema Scanner';
                        
                        showVerificacaoSucesso(equipamento);
                        renderCatalogoMateriais();
                        adicionarVerificacaoRecente(equipamento);
                        stopQRScanner();
                    } else {
                        showScanError(`Material ${equipamento.nome} j√° foi verificado anteriormente.`);
                    }
                } else {
                    showScanError(`Material ${equipamento.nome} n√£o est√° no cat√°logo de verifica√ß√£o.`);
                }
            } else {
                showScanError('Equipamento n√£o encontrado para o c√≥digo: ' + qrData);
            }
        }

        function processManualCode() {
            const code = document.getElementById('manual-qr-input').value.trim();
            if (code) {
                processQRCode(code);
                document.getElementById('manual-qr-input').value = '';
            }
        }

        function showScanResult(equipamento) {
            hideScanResults();
            
            const resultDiv = document.getElementById('scan-result');
            const infoDiv = document.getElementById('scanned-equipment-info');
            
            infoDiv.innerHTML = `
                <div class="space-y-2">
                    <p><strong>C√≥digo:</strong> ${equipamento.codigo}</p>
                    <p><strong>Nome:</strong> ${equipamento.nome}</p>
                    <p><strong>Categoria:</strong> ${equipamento.categoria}</p>
                    <p><strong>Status:</strong> <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium text-white ${getStatusClass(equipamento.status)}">${equipamento.status}</span></p>
                    <p><strong>QR Code:</strong> <span class="font-mono text-sm">${equipamento.qrCode}</span></p>
                </div>
            `;
            
            resultDiv.classList.remove('hidden');
            
            // Fill the form
            document.getElementById('prestacao-equipamento').value = `${equipamento.codigo} - ${equipamento.nome}`;
            document.getElementById('prestacao-equipamento').dataset.equipamentoId = equipamento.id;
        }

        function showScanError(message) {
            hideScanResults();
            
            const errorDiv = document.getElementById('scan-error');
            errorDiv.querySelector('p').textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideScanResults() {
            document.getElementById('scan-result').classList.add('hidden');
            document.getElementById('scan-error').classList.add('hidden');
        }

        function showVerificacaoSucesso(equipamento) {
            hideScanResults();
            
            // Mostrar mensagem de sucesso
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2';
            successDiv.innerHTML = `
                <div class="text-2xl">‚úÖ</div>
                <div>
                    <div class="font-semibold">Material Verificado!</div>
                    <div class="text-sm">${equipamento.codigo} - ${equipamento.nome}</div>
                </div>
            `;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 4000);
        }

        // Cat√°logo Functions
        function renderCatalogoMateriais() {
            const container = document.getElementById('catalogo-materiais');
            const total = catalogoMateriais.length;
            const verificados = catalogoMateriais.filter(item => item.verificado).length;
            const pendentes = total - verificados;

            // Atualizar contadores
            document.getElementById('catalogo-total').textContent = total;
            document.getElementById('catalogo-verificados').textContent = verificados;
            document.getElementById('catalogo-pendentes').textContent = pendentes;

            // Renderizar itens do cat√°logo
            container.innerHTML = catalogoMateriais.map(item => {
                const equipamento = equipamentos.find(eq => eq.id === item.equipamentoId);
                if (!equipamento) return '';

                return `
                    <div class="border rounded-lg p-4 ${item.verificado ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <div class="text-2xl">
                                    ${item.verificado ? '‚úÖ' : '‚è≥'}
                                </div>
                                <div>
                                    <div class="font-semibold text-sm">${equipamento.codigo}</div>
                                    <div class="text-xs text-gray-600">${equipamento.categoria}</div>
                                </div>
                            </div>
                            <button onclick="generateQRCode('${equipamento.qrCode}')" class="text-blue-600 hover:text-blue-900 text-xs">
                                üì± QR
                            </button>
                        </div>
                        <div class="text-sm font-medium text-gray-900 mb-1">${equipamento.nome}</div>
                        <div class="text-xs text-gray-600 mb-2">${equipamento.descricao}</div>
                        
                        ${item.verificado ? `
                            <div class="text-xs text-green-600 font-medium">
                                ‚úì Verificado em ${new Date(item.dataVerificacao).toLocaleDateString('pt-BR')} √†s ${new Date(item.dataVerificacao).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}
                            </div>
                        ` : `
                            <div class="text-xs text-red-600 font-medium">
                                ‚ö†Ô∏è Pendente de verifica√ß√£o
                            </div>
                        `}
                    </div>
                `;
            }).join('');
        }

        function adicionarVerificacaoRecente(equipamento) {
            const container = document.getElementById('ultimas-verificacoes');
            const lista = document.getElementById('lista-verificacoes');
            
            container.classList.remove('hidden');
            
            const agora = new Date();
            const verificacaoHtml = `
                <div class="flex items-center space-x-3 p-2 bg-green-50 rounded border border-green-200">
                    <div class="text-green-600">‚úÖ</div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900">${equipamento.codigo} - ${equipamento.nome}</div>
                        <div class="text-xs text-gray-500">${agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
                    </div>
                </div>
            `;
            
            lista.insertAdjacentHTML('afterbegin', verificacaoHtml);
            
            // Manter apenas as √∫ltimas 5 verifica√ß√µes
            const items = lista.children;
            while (items.length > 5) {
                lista.removeChild(items[items.length - 1]);
            }
        }

        function resetCatalogo() {
            if (confirm('Tem certeza que deseja resetar todas as verifica√ß√µes do cat√°logo?')) {
                catalogoMateriais.forEach(item => {
                    item.verificado = false;
                    item.dataVerificacao = null;
                    item.responsavel = null;
                });
                
                renderCatalogoMateriais();
                
                // Limpar verifica√ß√µes recentes
                document.getElementById('ultimas-verificacoes').classList.add('hidden');
                document.getElementById('lista-verificacoes').innerHTML = '';
                
                // Mostrar mensagem
                const resetDiv = document.createElement('div');
                resetDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                resetDiv.textContent = 'Cat√°logo resetado com sucesso!';
                document.body.appendChild(resetDiv);
                
                setTimeout(() => {
                    resetDiv.remove();
                }, 3000);
            }
        }

        function gerarRelatorioCatalogo() {
            const total = catalogoMateriais.length;
            const verificados = catalogoMateriais.filter(item => item.verificado).length;
            const pendentes = total - verificados;
            const percentual = ((verificados / total) * 100).toFixed(1);
            
            const relatorio = `
                RELAT√ìRIO DE VERIFICA√á√ÉO DE MATERIAIS
                =====================================
                
                Data: ${new Date().toLocaleDateString('pt-BR')}
                Hora: ${new Date().toLocaleTimeString('pt-BR')}
                
                RESUMO:
                - Total de materiais: ${total}
                - Verificados: ${verificados} (${percentual}%)
                - Pendentes: ${pendentes}
                
                DETALHAMENTO:
                ${catalogoMateriais.map(item => {
                    const equipamento = equipamentos.find(eq => eq.id === item.equipamentoId);
                    const status = item.verificado ? '‚úì VERIFICADO' : '‚úó PENDENTE';
                    const data = item.verificado ? ` - ${new Date(item.dataVerificacao).toLocaleDateString('pt-BR')}` : '';
                    return `${equipamento.codigo} - ${equipamento.nome}: ${status}${data}`;
                }).join('\n')}
                
                =====================================
                Sistema de Controle - Corpo de Bombeiros
            `;
            
            // Criar modal com o relat√≥rio
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Relat√≥rio de Verifica√ß√£o</h3>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-80">
                        <pre class="text-sm text-gray-800 whitespace-pre-wrap font-mono">${relatorio}</pre>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                            Fechar
                        </button>
                        <button onclick="copiarRelatorio(\`${relatorio.replace(/`/g, '\\`')}\`)" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors">
                            üìã Copiar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function copiarRelatorio(texto) {
            navigator.clipboard.writeText(texto).then(() => {
                const copyDiv = document.createElement('div');
                copyDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                copyDiv.textContent = 'Relat√≥rio copiado para a √°rea de transfer√™ncia!';
                document.body.appendChild(copyDiv);
                
                setTimeout(() => {
                    copyDiv.remove();
                }, 3000);
            });
        }

        function finalizarVerificacao() {
            const total = catalogoMateriais.length;
            const verificados = catalogoMateriais.filter(item => item.verificado).length;
            const pendentes = total - verificados;
            
            if (pendentes > 0) {
                if (!confirm(`Ainda h√° ${pendentes} materiais pendentes de verifica√ß√£o. Deseja finalizar mesmo assim?`)) {
                    return;
                }
            }
            
            const percentual = ((verificados / total) * 100).toFixed(1);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Verifica√ß√£o Finalizada</h3>
                    </div>
                    <div class="p-6 text-center">
                        <div class="text-6xl mb-4">${pendentes === 0 ? 'üéâ' : 'üìä'}</div>
                        <h4 class="text-xl font-semibold text-gray-900 mb-2">
                            ${pendentes === 0 ? 'Verifica√ß√£o Completa!' : 'Verifica√ß√£o Parcial'}
                        </h4>
                        <p class="text-gray-600 mb-4">
                            ${verificados} de ${total} materiais verificados (${percentual}%)
                        </p>
                        <div class="text-sm text-gray-500">
                            Finalizado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}
                        </div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                            Fechar
                        </button>
                        <button onclick="gerarRelatorioCatalogo(); this.parentElement.parentElement.parentElement.remove();" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors">
                            üìä Ver Relat√≥rio
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Presta√ß√£o de Contas Functions
        function renderPrestacoes() {
            const tbody = document.getElementById('prestacoes-table');
            tbody.innerHTML = prestacoes.map(prestacao => {
                const equipamento = equipamentos.find(eq => eq.id === prestacao.equipamentoId);
                const dataHora = new Date(prestacao.dataHora);
                
                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${dataHora.toLocaleDateString('pt-BR')} ${dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${equipamento ? `${equipamento.codigo} - ${equipamento.nome}` : 'Equipamento n√£o encontrado'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${prestacao.responsavel}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getAcaoClass(prestacao.acao)}">
                                ${prestacao.acao}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">${prestacao.observacoes}</td>
                    </tr>
                `;
            }).join('');
        }

        function getAcaoClass(acao) {
            switch(acao) {
                case 'Retirada': return 'bg-blue-100 text-blue-800';
                case 'Devolucao': return 'bg-green-100 text-green-800';
                case 'Inspecao': return 'bg-yellow-100 text-yellow-800';
                case 'Manutencao': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Form handler for presta√ß√£o de contas
        document.getElementById('prestacao-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const equipamentoField = document.getElementById('prestacao-equipamento');
            const equipamentoId = equipamentoField.dataset.equipamentoId;
            
            if (!equipamentoId) {
                showScanError('Por favor, escaneie um equipamento primeiro.');
                return;
            }
            
            const novaPrestacao = {
                id: prestacoes.length + 1,
                equipamentoId: parseInt(equipamentoId),
                responsavel: document.getElementById('prestacao-responsavel').value,
                acao: document.getElementById('prestacao-acao').value,
                observacoes: document.getElementById('prestacao-observacoes').value,
                dataHora: new Date().toISOString()
            };
            
            prestacoes.unshift(novaPrestacao); // Add to beginning of array
            renderPrestacoes();
            
            // Reset form
            this.reset();
            document.getElementById('prestacao-equipamento').value = '';
            delete document.getElementById('prestacao-equipamento').dataset.equipamentoId;
            hideScanResults();
            
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            successDiv.textContent = 'Presta√ß√£o de contas registrada com sucesso!';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9902615b52f7cace',t:'MTc2MDczMTIwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
